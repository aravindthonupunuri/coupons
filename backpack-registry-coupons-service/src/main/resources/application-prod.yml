lists:
  metrics:
    binders:
      http:
        enabled: true # we are using our own binder via our custom micronaut-metrics lib

jdbc-stmt:
  serverStatementTimeoutMillis: 200  # for server side statement timeout
  statementQueryTimeoutSeconds: 1    # for client side statement timeout

datasources:
  default:
    url: jdbc:postgresql://pgclx10399.hq.target.com/backpackcouponsprod?ssl=true&sslfactory=org.postgresql.ssl.NonValidatingFactory&sslmode=allow
    driverClassName: org.postgresql.Driver
    username: ${postgres-secret.username}
    password: ${postgres-secret.password}
    dialect: POSTGRES
    poolName: backpackregistrycoupon   # default autogenerated
    maximumPoolSize: ${postgres.max-db-pool-size}        # default 10
    minimumIdle: ${postgres.min-db-pool-size}            # default same as maximumPoolSize, valid if minimumIdle < maximumPoolSize
    idleTimeout: 600000       # default 600000ms (10min)
    maxLifetime: 1800000      # default 1800000ms (30min), should be shorter than any database imposed connection time limit
    connectionTimeout: 10000  # default: 30000ms (30 seconds)

jackson:
  property-naming-strategy: "SNAKE_CASE"

logging:
  mdc:
    enabled: true
    keys:
      - profile_id
      - x-api-id
    filter:
      path: /lists/**

resilience4j:
  circuit-breaker:
    failure-rate-threshold: 50                        # failure rate threshold in percentage (default: 50)
    wait-duration-secs-in-open-state: 10              # time cb waits before transitioning from open to half-open (default: 60s)
    sliding-window-type: TIME_BASED                   # possible values TIME_BASED or COUNT_BASED (default: COUNT_BASED)
    sliding-window-size: 100                          # seconds for TIME_BASED, request-count for COUNT_BASED (default: 100)
    minimum-number-of-calls: 10                       # min calls required (per sliding window period) before cb calculates error rate (default: 10)
    permitted-number-of-calls-in-half-open-state: 10  # min calls permitted when circuit breaker is half open

tracing:
  zipkin:
    enabled: true
    excluded-paths: /health
    b3-propagation-suppress: true
    sample-rate-percent: 0.1
    kafka:
      bootstrap-servers: tracing-kafka-broker.service.tgt-pe-prod-us-central1.consul.c-prod.gcp.cloud.target.internal:9092
      topic: tracing-zipkin-common
    app:
      name: backpackregistry
      env: prod
      region: tdc

registry:
  baby:
    sla: 56
    coupon-types:
      - STORE
      - ONLINE
  wedding:
    sla: 7
    coupon-types:
      - STORE
      - ONLINE
  completion-coupon:
    sla: 14
    expiration-days: 180
    db-fetch-size: 10000
    coupon-assignment-hour-of-day: 2
    coupon-assignment-minute-block-of-hour: 1

notification-tracer:
  client-id: notification-tracer-producer
  source: ${notification.source}
  dlq-source: ${notification.dlq-source}
  kafka:
    producer:
      enabled: ${notification.enabled}
    topic: tracer-general-input

api:
  oauth:
    url: https://oauth.iam.target.com
    client-id: ${api-auth.id2-client-id}
    client-secret: ${api-auth.id2-client-secret}
    nuid-username: ${api-auth.id2-nuid-username}
    nuid-password: ${api-auth.id2-nuid-password}

api-key: ${global-secret.api-key}
